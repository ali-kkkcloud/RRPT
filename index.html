<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>G4S Fleet Management Dashboard</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
</head>
<body>
    <div class="dashboard-container">
        <!-- Header -->
        <header class="dashboard-header">
            <div class="header-content">
                <div class="header-left">
                    <div class="logo">
                        <div class="logo-icon">üöó</div>
                        <div class="logo-text">
                            <h1>G4S Fleet Management</h1>
                            <p>Last updated: <span id="last-updated"></span></p>
                        </div>
                    </div>
                </div>
                <div class="header-right">
                    <div class="date-selector">
                        <label for="date-select">üìÖ Select Date:</label>
                        <select id="date-select">
                            <option value="25 August">25 August</option>
                            <option value="24 August">24 August</option>
                            <option value="23 August">23 August</option>
                        </select>
                    </div>
                    <button id="refresh-btn" class="btn btn-primary">üîÑ Refresh</button>
                    <button id="export-btn" class="btn btn-secondary">üì• Export</button>
                </div>
            </div>
        </header>

        <!-- Navigation Tabs -->
        <nav class="tab-navigation">
            <button class="tab-btn active" data-tab="offline">
                <span class="tab-icon">üöó</span>
                Offline Reports
            </button>
            <button class="tab-btn" data-tab="ai-alerts">
                <span class="tab-icon">ü§ñ</span>
                AI Alerts
            </button>
            <button class="tab-btn" data-tab="speed">
                <span class="tab-icon">‚ö°</span>
                Speed Alarm
            </button>
        </nav>

        <!-- Tab Content -->
        <main class="tab-content">
            <!-- Offline Reports Tab -->
            <div id="offline" class="tab-pane active">
                <div class="summary-cards">
                    <div class="card">
                        <div class="card-header">
                            <h3>Total Offline</h3>
                            <span class="card-icon">üî¥</span>
                        </div>
                        <div class="card-value" id="total-offline">0</div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <h3>Parking/Garage</h3>
                            <span class="card-icon">üÖøÔ∏è</span>
                        </div>
                        <div class="card-value" id="parking-count">0</div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <h3>Technical Issues</h3>
                            <span class="card-icon">üîß</span>
                        </div>
                        <div class="card-value" id="technical-count">0</div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <h3>Avg Offline Hours</h3>
                            <span class="card-icon">‚è∞</span>
                        </div>
                        <div class="card-value" id="avg-offline">0</div>
                    </div>
                </div>

                <div class="charts-grid">
                    <div class="chart-container">
                        <h3>Status Distribution</h3>
                        <canvas id="status-pie-chart"></canvas>
                    </div>
                    <div class="chart-container">
                        <h3>Regional Distribution</h3>
                        <canvas id="region-bar-chart"></canvas>
                    </div>
                </div>

                <div class="data-table-container">
                    <h3>Offline Vehicles</h3>
                    <table id="offline-table">
                        <thead>
                            <tr>
                                <th>Vehicle Number</th>
                                <th>Last Online</th>
                                <th>Offline Hours</th>
                                <th>Current Status</th>
                                <th>Remarks</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- AI Alerts Tab -->
            <div id="ai-alerts" class="tab-pane">
                <div class="summary-cards">
                    <div class="card">
                        <div class="card-header">
                            <h3>Total Alerts</h3>
                            <span class="card-icon">üö®</span>
                        </div>
                        <div class="card-value" id="total-alerts">0</div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <h3>Unique Vehicles</h3>
                            <span class="card-icon">üöõ</span>
                        </div>
                        <div class="card-value" id="unique-vehicles-alerts">0</div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <h3>Top Violator</h3>
                            <span class="card-icon">‚ö†Ô∏è</span>
                        </div>
                        <div class="card-value" id="top-violator">-</div>
                    </div>
                </div>

                <div class="charts-grid">
                    <div class="chart-container">
                        <h3>Vehicle-wise Alerts</h3>
                        <canvas id="vehicle-alerts-chart"></canvas>
                    </div>
                    <div class="chart-container">
                        <h3>Alert Type Distribution</h3>
                        <canvas id="alert-type-chart"></canvas>
                    </div>
                </div>

                <div class="data-table-container">
                    <h3>AI Alerts Details</h3>
                    <table id="alerts-table">
                        <thead>
                            <tr>
                                <th>Vehicle</th>
                                <th>Company</th>
                                <th>Alert Type</th>
                                <th>Time</th>
                                <th>Evidence</th>
                            </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Speed Alarm Tab -->
            <div id="speed" class="tab-pane">
                <div class="summary-cards">
                    <div class="card">
                        <div class="card-header">
                            <h3>Total Violations</h3>
                            <span class="card-icon">üö®</span>
                        </div>
                        <div class="card-value" id="total-violations">0</div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <h3>Warnings</h3>
                            <span class="card-icon">‚ö†Ô∏è</span>
                        </div>
                        <div class="card-value" id="warning-count">0</div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <h3>Alarms</h3>
                            <span class="card-icon">üö®</span>
                        </div>
                        <div class="card-value" id="alarm-count">0</div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <h3>Max Speed</h3>
                            <span class="card-icon">üìà</span>
                        </div>
                        <div class="card-value" id="max-speed">0</div>
                    </div>
                </div>

                <div class="charts-grid">
                    <div class="chart-container">
                        <h3>Speed Violations by Vehicle</h3>
                        <canvas id="speed-violations-chart"></canvas>
                    </div>
                    <div class="chart-container">
                        <h3>Speed Category Distribution</h3>
                        <canvas id="speed-category-chart"></canvas>
                    </div>
                </div>

                <div class="data-table-container">
                    <h3>Speed Violations Details</h3>
                    <table id="speed-table">
                        <thead>
                            <tr>
                                <th>Vehicle</th>
                                <th>Company</th>
                                <th>Max Speed</th>
                                <th>Warnings</th>
                                <th>Alarms</th>
                                <th>Total Violations</th>
                            </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                </div>
            </div>
        </main>
    </div>

    <!-- Status Edit Modal -->
    <div id="status-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Update Vehicle Status</h3>
                <span class="close">&times;</span>
            </div>
            <div class="modal-body">
                <p>Vehicle: <strong id="modal-vehicle"></strong></p>
                <div class="form-group">
                    <label for="status-select">Status:</label>
                    <select id="status-select">
                        <option value="Online">‚úÖ Online</option>
                        <option value="Parking/Garage">üÖøÔ∏è Parking/Garage</option>
                        <option value="Dashcam Issue">üì∑ Dashcam Issue</option>
                        <option value="Technical Problem">üîß Technical Problem</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="reason-input">Reason (Optional):</label>
                    <textarea id="reason-input" placeholder="Enter reason for status update..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button id="save-status" class="btn btn-primary">Save</button>
                <button id="cancel-status" class="btn btn-secondary">Cancel</button>
            </div>
        </div>
    </div>

    <div id="loading" class="loading">
        <div class="spinner"></div>
        <p>Loading fleet data...</p>
    </div>

    <script src="app.js"></script>
</body>
</html>
